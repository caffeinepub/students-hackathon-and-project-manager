# Deployment Guide

## Pre-Deployment Checklist

- [ ] All tests passing
- [ ] Code reviewed and approved
- [ ] Environment variables configured
- [ ] Backend canister deployed
- [ ] Frontend build successful
- [ ] **Gemini API key configured (server-side only)**

## Gemini API Configuration

### Important Security Notes

⚠️ **CRITICAL**: The Gemini API key must NEVER be exposed to the frontend or committed to version control.

- The API key is used **server-side only** by the backend canister
- The key must be configured via deployment secrets or environment variables
- Frontend code does NOT have access to the API key
- All Gemini API calls are proxied through the backend

### Setting Up the Gemini API Key

#### For Local Development

1. Obtain a Gemini API key from [Google AI Studio](https://makersuite.google.com/app/apikey)
2. The backend uses IC secrets placeholder: `{IC_SECRETS_GEMINI_API_KEY}`
3. For local testing, you may need to modify the backend temporarily (not recommended for production)

#### For Production Deployment

1. Configure the API key via IC secrets management:
   ```bash
   # Set the secret during deployment
   dfx deploy backend --argument '(opt record { geminiApiKey = "YOUR_API_KEY_HERE" })'
   ```

2. Or use environment variable substitution in your CI/CD pipeline

3. Verify the key is configured:
   - Test the chatbot functionality
   - Check backend logs for Gemini API responses
   - Ensure no API key errors appear

### Troubleshooting Gemini Configuration

If users see "The AI service is not configured properly":
- The backend's `geminiApiKey` variable is not set
- Check deployment secrets configuration
- Verify the API key is valid and active
- Check Google Cloud Console for API quota/billing

If users see "The AI service API key is invalid":
- The provided API key is incorrect or expired
- Generate a new key from Google AI Studio
- Update the deployment configuration

## Step-by-Step Deployment

1. **Build the frontend**
   ```bash
   cd frontend
   npm run build
   ```

2. **Deploy the backend canister**
   ```bash
   dfx deploy backend
   ```

3. **Deploy the frontend**
   ```bash
   dfx deploy frontend
   ```

4. **Verify deployment**
   - Check the build version marker in the footer
   - Test authentication flow
   - Test chatbot with Gemini integration
   - Verify all routes are accessible

## Verification Procedures

### Build Version Check
- Open the application
- Scroll to footer
- Verify build timestamp matches deployment time
- Format: `Build: YYYY-MM-DD HH:mm:ss UTC`

### Gemini Integration Check
- Navigate to AI Assistant page
- Send a test message
- Verify response is generated by Gemini
- Check for any error messages
- Monitor backend logs for API calls

### Functional Testing
- [ ] Login/logout works
- [ ] Profile creation/editing works
- [ ] Achievement creation works
- [ ] Verification workflow works
- [ ] Search functionality works
- [ ] **Chatbot responds with Gemini-powered answers**

## Troubleshooting

### Common Issues

1. **Chatbot not responding**
   - Check Gemini API key configuration
   - Verify backend canister is running
   - Check browser console for errors
   - Review backend logs for API errors

2. **Rate limiting errors**
   - Gemini API has rate limits
   - Wait a few moments before retrying
   - Consider upgrading API quota if needed

3. **Timeout errors**
   - Gemini API calls may take time
   - Check network connectivity
   - Verify IC HTTPS outcalls are working

4. **Backend initialization errors**
   - Wait for canister to fully initialize
   - Check access control setup
   - Verify admin user is configured

### Getting Help

If issues persist:
1. Check backend logs: `dfx canister logs backend`
2. Review browser console errors
3. Verify all environment variables are set
4. Contact support with error messages and logs
